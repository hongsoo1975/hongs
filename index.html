<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streaming Scoreboard Display</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
        
        body {
            margin: 0;
            padding: 0;
            background: transparent !important;
            font-family: 'Noto Sans KR', sans-serif;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            touch-action: none;
        }

        .scoreboard {
            background: rgba(30, 64, 175, 0.95);
            border-radius: 8px;
            padding: 4px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            display: inline-block;
            transform-origin: top left;
            touch-action: none;
        }

        table {
            border-collapse: collapse;
            background: rgba(30, 64, 175, 0.95);
            border-radius: 8px;
            overflow: hidden;
        }

        td {
            padding: 10px 20px;
            text-align: center;
            color: white;
            border: 1px solid rgba(30, 58, 138, 0.5);
            background: rgba(30, 64, 175, 0.95);
        }

        .team-name {
            background: rgba(30, 64, 175, 0.95);
            font-size: 18px;
            font-weight: 500;
            min-width: 150px;
            text-align: center;
            color: white;
        }

        .score {
            background: rgba(37, 99, 235, 0.95);
            font-size: 24px;
            font-weight: bold;
            min-width: 60px;
            text-align: center;
            color: white;
            transition: all 0.3s ease;
        }

        .score.current {
            background: rgba(59, 130, 246, 0.95);
        }

        .score.hidden {
            display: none;
        }

        .drag-handle {
            position: absolute;
            top: -20px;
            left: 0;
            right: 0;
            height: 20px;
            background: rgba(0, 0, 0, 0.5);
            cursor: move;
            opacity: 0;
            transition: opacity 0.2s;
            border-radius: 4px;
            touch-action: none;
        }

        .resize-handle {
            position: absolute;
            bottom: -20px;
            right: -20px;
            width: 20px;
            height: 20px;
            background: rgba(0, 0, 0, 0.5);
            cursor: se-resize;
            opacity: 0;
            transition: opacity 0.2s;
            border-radius: 50%;
            touch-action: none;
        }

        .scoreboard-container {
            background: transparent;
            position: absolute;
            touch-action: none;
        }

        .scoreboard-container:hover .drag-handle,
        .scoreboard-container:hover .resize-handle {
            opacity: 1;
        }

        html, body {
            background: none !important;
        }

        /* 추가된 스타일 - 깔끔한 테두리와 그림자 */
        .scoreboard {
            background: rgba(30, 64, 175, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 
                       0 0 15px rgba(59, 130, 246, 0.3);
        }

        .team-name {
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        }

        .score {
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .score.current {
            box-shadow: inset 0 0 10px rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body>
    <!-- HTML 부분은 이전과 동일 -->
    <div class="scoreboard-container">
        <div class="drag-handle"></div>
        <div class="scoreboard">
            <table>
                <tr id="team1-row">
                    <td class="team-name">팀 1</td>
                    <td class="score" data-set="1">0</td>
                    <td class="score hidden" data-set="2">0</td>
                    <td class="score hidden" data-set="3">0</td>
                </tr>
                <tr id="team2-row">
                    <td class="team-name">팀 2</td>
                    <td class="score" data-set="1">0</td>
                    <td class="score hidden" data-set="2">0</td>
                    <td class="score hidden" data-set="3">0</td>
                </tr>
            </table>
        </div>
        <div class="resize-handle"></div>
    </div>

    <script>
        // 이전 스크립트 코드 모두 유지
        const container = document.querySelector('.scoreboard-container');
        const scoreboard = document.querySelector('.scoreboard');
        const dragHandle = document.querySelector('.drag-handle');
        const resizeHandle = document.querySelector('.resize-handle');

        let isDragging = false;
        let isResizing = false;
        let currentX;
        let currentY;
        let initialX;
        let initialY;
        let initialWidth;
        let initialHeight;

        // 저장된 위치와 크기 불러오기
        let xOffset = parseInt(localStorage.getItem('scoreboardX')) || 50;
        let yOffset = parseInt(localStorage.getItem('scoreboardY')) || 50;
        let scale = parseFloat(localStorage.getItem('scoreboardScale')) || 1;

        // 초기 위치와 크기 설정
        setTranslate(xOffset, yOffset, container);
        setScale(scale);

        // 드래그 이벤트
        dragHandle.addEventListener('mousedown', dragStart);
        dragHandle.addEventListener('touchstart', dragStart);

        // 리사이즈 이벤트
        resizeHandle.addEventListener('mousedown', resizeStart);
        resizeHandle.addEventListener('touchstart', resizeStart);

        document.addEventListener('mousemove', move);
        document.addEventListener('touchmove', move);
        document.addEventListener('mouseup', end);
        document.addEventListener('touchend', end);

        function dragStart(e) {
            if (e.type === 'touchstart') {
                initialX = e.touches[0].clientX - xOffset;
                initialY = e.touches[0].clientY - yOffset;
            } else {
                initialX = e.clientX - xOffset;
                initialY = e.clientY - yOffset;
            }

            if (e.target === dragHandle) {
                isDragging = true;
            }
        }

        function resizeStart(e) {
            if (e.type === 'touchstart') {
                initialX = e.touches[0].clientX;
                initialY = e.touches[0].clientY;
            } else {
                initialX = e.clientX;
                initialY = e.clientY;
            }

            initialWidth = scale;
            isResizing = true;
        }

        function move(e) {
            if (isDragging) {
                e.preventDefault();
                
                if (e.type === 'touchmove') {
                    currentX = e.touches[0].clientX - initialX;
                    currentY = e.touches[0].clientY - initialY;
                } else {
                    currentX = e.clientX - initialX;
                    currentY = e.clientY - initialY;
                }

                xOffset = currentX;
                yOffset = currentY;
                setTranslate(currentX, currentY, container);
            }

            if (isResizing) {
                e.preventDefault();
                
                let currentWidth;
                if (e.type === 'touchmove') {
                    currentWidth = initialWidth + (e.touches[0].clientX - initialX) * 0.005;
                } else {
                    currentWidth = initialWidth + (e.clientX - initialX) * 0.005;
                }

                currentWidth = Math.max(0.5, Math.min(2, currentWidth));
                setScale(currentWidth);
            }
        }

        function end() {
            isDragging = false;
            isResizing = false;
        }

        function setTranslate(xPos, yPos, el) {
            el.style.left = xPos + "px";
            el.style.top = yPos + "px";
            localStorage.setItem('scoreboardX', xPos);
            localStorage.setItem('scoreboardY', yPos);
        }

        function setScale(newScale) {
            scale = newScale;
            scoreboard.style.transform = `scale(${scale})`;
            localStorage.setItem('scoreboardScale', scale);
        }

        // 구글 시트 데이터 가져오기
        const SHEET_ID = '1wlPWiFQaIS39ZjgGTU9FomJBOw7q-6hQCK03G9mMdYk';
        const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv`;
        
        let lastData = null;

        async function updateScoreboard() {
            try {
                const response = await fetch(`${SHEET_URL}&_=${Date.now()}`);
                const text = await response.text();
                const rows = text.split('\n').map(row => 
                    row.split(',').map(cell => cell.replace(/"/g, '').trim())
                );

                const currentData = {
                    currentSet: parseInt(rows[1][1]) || 1,
                    team1: {
                        name: rows[1][0],
                        scores: [rows[1][2], rows[1][3], rows[1][4]]
                    },
                    team2: {
                        name: rows[2][0],
                        scores: [rows[2][2], rows[2][3], rows[2][4]]
                    }
                };

                if (!lastData || JSON.stringify(lastData) !== JSON.stringify(currentData)) {
                    const teamNames = document.querySelectorAll('.team-name');
                    const team1Scores = document.querySelectorAll('#team1-row .score');
                    const team2Scores = document.querySelectorAll('#team2-row .score');

                    teamNames[0].textContent = currentData.team1.name;
                    teamNames[1].textContent = currentData.team2.name;

                    team1Scores.forEach(score => score.classList.add('hidden'));
                    team2Scores.forEach(score => score.classList.add('hidden'));

                    for (let i = 0; i < currentData.currentSet; i++) {
                        team1Scores[i].classList.remove('hidden');
                        team2Scores[i].classList.remove('hidden');
                        team1Scores[i].textContent = currentData.team1.scores[i] || '0';
                        team2Scores[i].textContent = currentData.team2.scores[i] || '0';
                        
                        team1Scores[i].classList.toggle('current', i === currentData.currentSet - 1);
                        team2Scores[i].classList.toggle('current', i === currentData.currentSet - 1);
                    }

                    lastData = currentData;
                }
            } catch (error) {
                console.error('Error fetching scoreboard data:', error);
            }
        }

        setInterval(updateScoreboard, 1000);
        updateScoreboard();
    </script>
</body>
</html>
