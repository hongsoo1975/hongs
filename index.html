<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streaming Scoreboard Overlay</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
        
        body {
            margin: 0;
            padding: 0;
            background: transparent;
            overflow: hidden;
            font-family: 'Noto Sans KR', sans-serif;
        }
        
        input {
            font-family: 'Noto Sans KR', sans-serif;
        }

        input:-webkit-autofill,
        input:-webkit-autofill:hover,
        input:-webkit-autofill:focus,
        input:-webkit-autofill:active {
            -webkit-box-shadow: 0 0 0 30px rgba(17, 24, 39, 0.95) inset !important;
            -webkit-text-fill-color: white !important;
        }

        .drag-handle {
            position: absolute;
            top: -20px;
            left: 0;
            right: 0;
            height: 20px;
            background: rgba(0, 0, 0, 0.5);
            cursor: move;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .scoreboard-container:hover .drag-handle {
            opacity: 1;
        }

        .team-name {
            transition: all 0.2s ease-in-out;
        }

        .team-name:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .score-cell {
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            transition: all 0.2s ease-in-out;
        }

        .score-cell.current {
            background-color: rgba(59, 130, 246, 0.2);
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/javascript">
        const Scoreboard = () => {
            const [state, setState] = React.useState({
                setCount: 1,
                scores: {
                    team1: [0, 0, 0],
                    team2: [0, 0, 0]
                },
                teamNames: {
                    team1: '팀 1',
                    team2: '팀 2'
                },
                editingTeam: null,
                currentSet: 0,
                position: { x: 50, y: 50 }
            });

            const [isDragging, setIsDragging] = React.useState(false);
            const [dragStart, setDragStart] = React.useState({ x: 0, y: 0 });
            const inputRef = React.useRef(null);

            React.useEffect(() => {
                if (inputRef.current) {
                    inputRef.current.focus();
                }
            }, [state.editingTeam]);

            const handleMouseDown = (e) => {
                setIsDragging(true);
                setDragStart({
                    x: e.clientX - state.position.x,
                    y: e.clientY - state.position.y
                });
            };

            const handleMouseMove = React.useCallback((e) => {
                if (isDragging) {
                    setState(prev => ({
                        ...prev,
                        position: {
                            x: e.clientX - dragStart.x,
                            y: e.clientY - dragStart.y
                        }
                    }));
                }
            }, [isDragging, dragStart]);

            const handleMouseUp = () => {
                setIsDragging(false);
            };

            React.useEffect(() => {
                window.addEventListener('mousemove', handleMouseMove);
                window.addEventListener('mouseup', handleMouseUp);
                return () => {
                    window.removeEventListener('mousemove', handleMouseMove);
                    window.removeEventListener('mouseup', handleMouseUp);
                };
            }, [handleMouseMove]);

            React.useEffect(() => {
                const savedState = localStorage.getItem('scoreboard-state');
                if (savedState) {
                    setState(JSON.parse(savedState));
                }
            }, []);

            React.useEffect(() => {
                localStorage.setItem('scoreboard-state', JSON.stringify(state));
            }, [state]);

            const handleScore = (team, setIndex, increment) => {
                setState(prev => {
                    const newScores = { ...prev.scores };
                    newScores[team] = [...prev.scores[team]];
                    newScores[team][setIndex] = Math.max(0, newScores[team][setIndex] + (increment ? 1 : -1));
                    return { ...prev, scores: newScores };
                });
            };

            const handleTeamNameChange = (team, newName) => {
                setState(prev => ({
                    ...prev,
                    teamNames: {
                        ...prev.teamNames,
                        [team]: newName || `팀 ${team.slice(-1)}`
                    },
                    editingTeam: null
                }));
            };

            const handleKeyDown = (e, team) => {
                if (e.key === 'Enter') {
                    handleTeamNameChange(team, e.target.value);
                }
            };

            const addSet = () => {
                if (state.setCount < 3) {
                    setState(prev => ({
                        ...prev,
                        setCount: prev.setCount + 1,
                        currentSet: prev.setCount
                    }));
                }
            };

            const removeSet = () => {
                if (state.setCount > 1) {
                    setState(prev => ({
                        ...prev,
                        setCount: prev.setCount - 1,
                        currentSet: prev.setCount - 2
                    }));
                }
            };

            return React.createElement('div', {
                className: 'scoreboard-container',
                style: {
                    position: 'absolute',
                    left: `${state.position.x}px`,
                    top: `${state.position.y}px`,
                }
            }, [
                React.createElement('div', {
                    className: 'drag-handle',
                    onMouseDown: handleMouseDown,
                    key: 'drag-handle'
                }),
                React.createElement('div', {
                    className: 'inline-block bg-gray-900 bg-opacity-95 rounded-lg p-[2px] shadow-2xl',
                    key: 'scoreboard'
                }, [
                    React.createElement('div', {
                        className: 'relative flex items-center rounded-lg overflow-hidden bg-gray-900 bg-opacity-95 border border-gray-700',
                        key: 'scoreboard-inner'
                    }, [
                        React.createElement('table', {
                            className: 'border-collapse',
                            key: 'table'
                        }, 
                            React.createElement('tbody', {}, [
                                ...['team1', 'team2'].map((team) =>
                                    React.createElement('tr', {
                                        key: team,
                                        className: 'h-16'
                                    }, [
                                        React.createElement('td', {
                                            className: 'team-name relative bg-opacity-5 font-medium text-lg text-white px-6 w-48 cursor-pointer rounded-l',
                                            onClick: () => setState(prev => ({ ...prev, editingTeam: team }))
                                        }, 
                                            state.editingTeam === team
                                                ? React.createElement('input', {
                                                    ref: inputRef,
                                                    type: 'text',
                                                    value: state.teamNames[team],
                                                    onChange: (e) => {
                                                        const newName = e.target.value;
                                                        setState(prev => ({
                                                            ...prev,
                                                            teamNames: {
                                                                ...prev.teamNames,
                                                                [team]: newName
                                                            }
                                                        }));
                                                    },
                                                    onKeyDown: (e) => handleKeyDown(e, team),
                                                    onBlur: (e) => handleTeamNameChange(team, e.target.value),
                                                    className: 'w-full h-10 px-3 bg-gray-800 border border-blue-500 rounded text-white focus:outline-none focus:ring-2 focus:ring-blue-500'
                                                })
                                                : state.teamNames[team]
                                        ),
                                        ...Array.from({ length: state.setCount }).map((_, i) => [
                                            React.createElement('td', {
                                                key: `score-${i}`,
                                                className: `score-cell relative font-bold text-2xl text-white w-16 text-center border-l border-gray-700 ${i === state.currentSet ? 'current' : ''}`
                                            }, state.scores[team][i]),
                                            React.createElement('td', {
                                                key: `control-${i}`,
                                                className: 'w-8 bg-gray-800 bg-opacity-50 p-0'
                                            },
                                                i === state.currentSet && React.createElement('div', {
                                                    className: 'flex flex-col h-full'
                                                }, [
                                                    React.createElement('button', {
                                                        key: 'plus',
                                                        onClick: () => handleScore(team, i, true),
                                                        className: 'h-8 w-8 flex items-center justify-center text-white bg-green-600 hover:bg-green-500 transition-colors'
                                                    }, '+'),
                                                    React.createElement('button', {
                                                        key: 'minus',
                                                        onClick: () => handleScore(team, i, false),
                                                        className: 'h-8 w-8 flex items-center justify-center text-white bg-red-600 hover:bg-red-500 transition-colors'
                                                    }, '-')
                                                ])
                                            )
                                        ]).flat()
                                    ])
                                ),
                                React.createElement('tr', {
                                    key: 'controls',
                                    className: 'h-6 bg-gray-800 bg-opacity-50'
                                },
                                    React.createElement('td', {
                                        colSpan: 7,
                                        className: 'text-center'
                                    },
                                        React.createElement('div', {
                                            className: 'flex justify-center gap-2 py-1'
                                        }, [
                                            React.createElement('button', {
                                                key: 'add',
                                                onClick: addSet,
                                                disabled: state.setCount >= 3,
                                                className: 'w-6 h-6 flex items-center justify-center bg-blue-600 hover:bg-blue-500 disabled:bg-gray-600 disabled:opacity-50 text-white rounded-full text-sm transition-colors'
                                            }, '+'),
                                            React.createElement('button', {
                                                key: 'remove',
                                                onClick: removeSet,
                                                disabled: state.setCount <= 1,
                                                className: 'w-6 h-6 flex items-center justify-center bg-blue-600 hover:bg-blue-500 disabled:bg-gray-600 disabled:opacity-50 text-white rounded-full text-sm transition-colors'
                                            }, '-')
                                        ])
                                    )
                                )
                            ])
                        )
                    ])
                ])
            ]);
        };

        ReactDOM.render(
            React.createElement(Scoreboard),
            document.getElementById('root')
        );
    </script>
</body>
</html>